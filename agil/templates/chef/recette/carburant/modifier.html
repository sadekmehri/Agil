{% extends "./chef/layout/layout.html" %}
{% block body %}
<link href="{{ url_for('static', filename='css/bootstrap-datepicker.min.css') }}" rel="stylesheet" type="text/css">
<script type='text/javascript' src="{{ url_for('static', filename='js/bootstrap-datepicker.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/anytime.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.inputmask.min.js') }}"></script>
<div class="page-header page-header-light">
   <div class="breadcrumb-line breadcrumb-line-light header-elements-md-inline">
      <div class="d-flex">
         <div class="breadcrumb">
            <a href="{{ url_for('chef.index') }}" class="breadcrumb-item"><i class="icon-home2 mr-2"></i>Home</a>
            <a href="{{ url_for('chef.consulter_recette_carburant') }}" class="breadcrumb-item">Recette Carburant</a>
            <span class="breadcrumb-item active">Modifier</span>
         </div>
         <a href="#" class="header-elements-toggle text-default d-md-none"><i class="icon-more"></i></a>
      </div>
   </div>
</div>
<div class="content">
<div class="row">
   <div class="col-md-3"></div>
   <div class="col-md-6">
      <div class="card">
         <div class="card-header header-elements-inline">
            <h5 class="card-title">Modifier Recette Carburant</h5>
         </div>
         <div class="card-body">
            <form method="post" action="">
               {{ form.hidden_tag() }}
               <div class="form-group">
                  {{ form.Pmp.label(class="font-weight-semibold") }}
                  {% if form.Pmp.errors %}
                  {{ form.Pmp(class="form-control is-invalid",autocomplete="off") }}
                  <div class="invalid-feedback">
                     {% for error in form.Pmp.errors %}
                     <span class="form-text text-danger">
                     {{ error }}
                     </span>
                     {% endfor %}
                  </div>
                  {% else %}
                  {{ form.Pmp(class="form-control",autocomplete="off") }}
                  {% endif %}
               </div>
               <div class="form-group">
                  {{ form.Voie.label(class="font-weight-semibold") }}
                  {% if form.Voie.errors %}
                  {{ form.Voie(class="form-control is-invalid",autocomplete="off") }}
                  <div class="invalid-feedback">
                     {% for error in form.Voie.errors %}
                     <span class="form-text text-danger">
                     {{ error }}
                     </span>
                     {% endfor %}
                  </div>
                  {% else %}
                  {{ form.Voie(class="form-control",autocomplete="off") }}
                  {% endif %}
               </div>
               <div class="form-group">
                  {{ form.Cit.label(class="font-weight-semibold") }}
                  {% if form.Cit.errors %}
                  {{ form.Cit(class="form-control is-invalid",autocomplete="off") }}
                  <div class="invalid-feedback">
                     {% for error in form.Cit.errors %}
                     <span class="form-text text-danger">
                     {{ error }}
                     </span>
                     {% endfor %}
                  </div>
                  {% else %}
                  {{ form.Cit(class="form-control",autocomplete="off") }}
                  {% endif %}
               </div>
               <div class="form-group">
                  {{ form.Car.label(class="font-weight-semibold") }}
                  {% if form.Car.errors %}
                  {{ form.Car(class="form-control is-invalid",autocomplete="off") }}
                  <div class="invalid-feedback">
                     {% for error in form.Car.errors %}
                     <span class="form-text text-danger">
                     {{ error }}
                     </span>
                     {% endfor %}
                  </div>
                  {% else %}
                  {{ form.Car(class="form-control",autocomplete="off") }}
                  {% endif %}
               </div>
               <div class="form-group">
                  {{ form.Groupe.label(class="font-weight-semibold") }}
                  {% if form.Groupe.errors %}
                  {{ form.Groupe(class="form-control is-invalid",autocomplete="off") }}
                  <div class="invalid-feedback">
                     {% for error in form.Groupe.errors %}
                     <span class="form-text text-danger">
                     {{ error }}
                     </span>
                     {% endfor %}
                  </div>
                  {% else %}
                  {{ form.Groupe(class="form-control",autocomplete="off") }}
                  {% endif %}
               </div>
               <div class="form-group">
                  {{ form.IndDebut.label(class="font-weight-semibold") }}
                  {% if form.IndDebut.errors %}
                  {{ form.IndDebut(class="form-control is-invalid",autocomplete="off") }}
                  <div class="invalid-feedback">
                     {% for error in form.IndDebut.errors %}
                     <span class="form-text text-danger">
                     {{ error }}
                     </span>
                     {% endfor %}
                  </div>
                  {% else %}
                  {{ form.IndDebut(class="form-control",placeholder="#",autocomplete="off") }}
                  {% endif %}
               </div>
               <div class="form-group">
                  {{ form.IndFin.label(class="font-weight-semibold") }}
                  {% if form.IndFin.errors %}
                  {{ form.IndFin(class="form-control is-invalid",autocomplete="off") }}
                  <div class="invalid-feedback">
                     {% for error in form.IndFin.errors %}
                     <span class="form-text text-danger">
                     {{ error }}
                     </span>
                     {% endfor %}
                  </div>
                  {% else %}
                  {{ form.IndFin(class="form-control",placeholder="#",autocomplete="off") }}
                  {% endif %}
               </div>
               <div class="form-group">
                  <div class="form-group">
                     {{ form.Date.label(class="font-weight-semibold") }}
                     {% if form.Date.errors %}
                     {{ form.Date(class="form-control is-invalid",autocomplete="off") }}
                     <div class="invalid-feedback">
                        {% for error in form.Date.errors %}
                        <span class="form-text text-danger">
                        {{ error }}
                        </span>
                        {% endfor %}
                     </div>
                     {% else %}
                     {{ form.Date(class="form-control",autocomplete="off") }}
                     {% endif %}
                  </div>
                  <div class="form-group">
                     {{ form.Prix.label(class="font-weight-semibold") }}
                     {% if form.Prix.errors %}
                     {{ form.Prix(class="form-control is-invalid",autocomplete="off") }}
                     <div class="invalid-feedback">
                        {% for error in form.Prix.errors %}
                        <span class="form-text text-danger">
                        {{ error }}
                        </span>
                        {% endfor %}
                     </div>
                     {% else %}
                     {{ form.Prix(class="form-control",placeholder="#",autocomplete="off") }}
                     {% endif %}
                     <small id="prixHelp" class="form-text text-muted">Si ce champ est vide, le prix actuel du carburant par défaut est considéré comme entrée.</small>
                  </div>
                  <div class="d-flex justify-content-end align-items-center">
                     <button type="reset" class="btn btn-secondary" id="reset">Reset <i class="icon-reload-alt ml-2"></i></button>
                     <button type="submit" class="btn btn-primary ml-3">Submit <i class="icon-paperplane ml-2"></i></button>
                  </div>
            </form>
            </div>
         </div>
         <div class="col-md-3"></div>
      </div>
   </div>
</div>
<script>
   $(document).ready(function() {

     $("#deb,#fin").inputmask({
         alias: 'numeric',
         allowMinus: false,
         digits: 1,
         max: 99999999.9
     });

     $('#prix').inputmask({
         alias: 'numeric',
         allowMinus: false,
         digits: 3,
         max: 99.999
     });

     $('#Date').datepicker({
         todayBtn: 'linked',
         format: "yyyy-mm-dd",
         autoclose: true,
         endDate:currrent_date()
     });

     function currrent_date() {
         var today = new Date();
         var dd = String(today.getDate()).padStart(2, '0');
         var mm = String(today.getMonth() + 1).padStart(2, '0');
         var yyyy = today.getFullYear();
         return (yyyy + '-' + mm + '-' + dd);
     }

     const csrf_token = $("#csrf_token").val();
     $.ajaxSetup({
         beforeSend: function(xhr, settings) {
             if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                 xhr.setRequestHeader("X-CSRFToken", csrf_token);
             }
         }
     });

     function ajax(id) {
         $.ajax({
             type: 'post',
             url: "{{ url_for('chef.dataRecette') }}",
             data: {
                 id: id
             },
             contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
             success: function(data) {
                 $("select").prop('required', true);
                 var opts = $.parseJSON(data);
                 $.each(opts, function(i, d) {
                     $('#cit').append('<option value="' + d.id + '">' + d.name + '</option>');
                 });
                 carburant();
             }
         });
     }

     function ajax1(id) {
         $.ajax({
             type: 'post',
             url: "{{ url_for('chef.dataPompe') }}",
             data: {
                 id: id
             },
             contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
             success: function(data) {
                 $("select").prop('required', true);
                 var opts = $.parseJSON(data);
                 $.each(opts, function(i, d) {
                     $('#car').append('<option value="' + d.id + '">' + d.name + '</option>');
                 });
             }
         });
     }

     citerne();

     function citerne() {
         const id = $("#pmp option:selected").val();
         $("#cit").empty();
         ajax(id);
     }

     $("#pmp").change(function() {
         const id = $(this).val();
         $("#cit").empty();
         ajax(id);
     });

     function carburant() {
         const id = $("#cit option:selected").val();
         $("#car").empty();
         ajax1(id);
     }

     $("#cit").change(function() {
         const id = $(this).val();
         $("#car").empty();
         ajax1(id);
     });

   });
</script>
{% endblock %}